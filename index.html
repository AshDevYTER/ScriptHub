<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Script Hub</title>
<link rel="icon" href="logo.png" type="image/png">
<link rel="apple-touch-icon" href="logo.png">
<style>
*{box-sizing:border-box;font-family:Inter,system-ui,Arial}
body{margin:0;background:#0b0b0b;color:#fff}
header{display:flex;align-items:center;gap:12px;padding:14px 18px;background:#000;position:fixed;top:0;left:0;right:0}
#logoWrap{width:40px;height:40px;border-radius:50%;overflow:hidden}
#logoWrap img{width:100%;height:100%;object-fit:cover}
header button{background:#4fc3f7;border:none;padding:10px 16px;border-radius:12px;font-weight:700;cursor:pointer}
main{margin-top:70px;padding:20px}
.upload{display:none;background:#111;padding:16px;border-radius:14px;margin-bottom:20px}
.scriptEditor{background:#0c0c0c;border:1px solid #222;border-radius:12px;padding:12px;margin-bottom:10px}
.scriptEditor textarea{width:100%;min-height:120px;background:#000;color:#fff;border:1px solid #333;border-radius:10px;padding:10px}
.addBtn,.uploadBtn{width:100%;margin-top:10px;background:#4fc3f7;border:none;padding:12px;border-radius:12px;font-weight:700;cursor:pointer}
.card{background:#111;border-radius:14px;padding:14px;margin-bottom:12px;cursor:pointer}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.8);display:none;align-items:center;justify-content:center}
.view{background:#000;width:90%;max-width:800px;padding:16px;border-radius:16px}
.scriptBlock{margin-bottom:14px}
.scriptBlock pre{background:#111;padding:12px;border-radius:10px;white-space:pre-wrap}
.copyBtn{margin-top:6px;background:#333;color:#fff;border:none;padding:6px 10px;border-radius:8px;cursor:pointer}
.deleteBtn{background:#ff5252;border:none;padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer;margin-top:10px}
</style>
</head>
<body>

<header>
<div id="logoWrap"><img src="logo.png"></div>
<button id="loginBtn">Login</button>
<button id="logoutBtn" style="display:none">Logout</button>
</header>

<main>
<div class="upload" id="uploadBox">
<input id="packTitle" placeholder="Script Pack Title" style="width:100%;padding:10px;margin-bottom:10px">
<div id="editors"></div>
<button class="addBtn" id="addEditor">Add One More Script</button>
<button class="uploadBtn" id="uploadPack">Upload Script Pack</button>
</div>
<div id="list"></div>
</main>

<div class="modal" id="viewModal">
<div class="view">
<h2 id="viewTitle"></h2>
<div id="viewScripts"></div>
<button class="uploadBtn" id="editBtn">Edit</button>
<button class="deleteBtn" id="deleteBtn">Delete</button>
<button class="uploadBtn" onclick="viewModal.style.display='none'">Close</button>
</div>
</div>

<script>
var ADMIN_PASSWORD='AshDevYTERISANIMEFUN'

var GITHUB_RAW_URL='https://raw.githubusercontent.com/AshDevYTER/ScriptHub/refs/heads/main/scripts.json'
var GITHUB_API_URL='https://api.github.com/repos/AshDevYTER/ScriptHub/contents/scripts.json'
var GITHUB_TOKEN='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'

var users=JSON.parse(localStorage.getItem('users')||'{}')
var currentUser=localStorage.getItem('currentUser')

var loginBtn=document.getElementById('loginBtn')
var logoutBtn=document.getElementById('logoutBtn')
var uploadBox=document.getElementById('uploadBox')

loginBtn.onclick=function(){
var u=prompt('Username')
var p=prompt('Password')
if(!users[u]) users[u]={password:p,role:'viewer'}
if(users[u].password!==p) return
if(p===ADMIN_PASSWORD) users[u].role='admin'
localStorage.setItem('users',JSON.stringify(users))
localStorage.setItem('currentUser',u)
currentUser=u
applyRole()
}

logoutBtn.onclick=function(){
localStorage.removeItem('currentUser')
location.reload()
}

function applyRole(){
loginBtn.style.display='none'
logoutBtn.style.display='inline-block'
uploadBox.style.display=users[currentUser].role==='admin'?'block':'none'
}

if(currentUser&&users[currentUser]) applyRole()

var editors=document.getElementById('editors')
function addEditor(v){
var d=document.createElement('div')
d.className='scriptEditor'
d.innerHTML='<textarea>'+ (v||'') +'</textarea>'
editors.appendChild(d)
}
addEditor()
document.getElementById('addEditor').onclick=function(){addEditor()}

var packs=[]
async function loadPacks(){
var r=await fetch(GITHUB_RAW_URL)
if(!r.ok) return
packs=await r.json()
renderList()
}
loadPacks()

function renderList(){
list.innerHTML=''
packs.forEach((p,i)=>{
var d=document.createElement('div')
d.className='card'
d.textContent=p.title
d.onclick=function(){openPack(i)}
list.appendChild(d)
})
}

var activeIndex=null
var viewModal=document.getElementById('viewModal')
var viewTitle=document.getElementById('viewTitle')
var viewScripts=document.getElementById('viewScripts')
var editBtn=document.getElementById('editBtn')
var deleteBtn=document.getElementById('deleteBtn')

function openPack(i){
activeIndex=i
var p=packs[i]
viewTitle.textContent=p.title
viewScripts.innerHTML=''
p.scripts.forEach(sc=>{
var b=document.createElement('div')
b.className='scriptBlock'
b.innerHTML='<pre>'+sc+'</pre>'
var c=document.createElement('button')
c.className='copyBtn'
c.textContent='Copy'
c.onclick=function(){navigator.clipboard.writeText(sc)}
b.appendChild(c)
viewScripts.appendChild(b)
})
var isAdmin=currentUser&&users[currentUser].role==='admin'
editBtn.style.display=isAdmin?'block':'none'
deleteBtn.style.display=isAdmin?'block':'none'
viewModal.style.display='flex'
}

editBtn.onclick=function(){
var p=packs[activeIndex]
viewModal.style.display='none'
uploadBox.style.display='block'
packTitle.value=p.title
editors.innerHTML=''
p.scripts.forEach(s=>addEditor(s))
}

async function saveToGitHub(){
var content=btoa(unescape(encodeURIComponent(JSON.stringify(packs,null,2))))
var sha=null
var r=await fetch(GITHUB_API_URL,{headers:{Authorization:'token '+GITHUB_TOKEN}})
if(r.ok){var j=await r.json();sha=j.sha}
await fetch(GITHUB_API_URL,{
method:'PUT',
headers:{Authorization:'token '+GITHUB_TOKEN,'Content-Type':'application/json'},
body:JSON.stringify({message:'update scripts',content:content,sha:sha})
})
location.reload()
}

document.getElementById('uploadPack').onclick=function(){
if(!currentUser||users[currentUser].role!=='admin') return
var title=packTitle.value.trim()
if(!title) return
var scripts=[]
editors.querySelectorAll('textarea').forEach(t=>{if(t.value.trim()) scripts.push(t.value)})
if(!scripts.length) return
if(activeIndex!==null){
packs[activeIndex]={title:title,scripts:scripts}
activeIndex=null
}else{
packs.unshift({title:title,scripts:scripts})
}
saveToGitHub()
}

deleteBtn.onclick=function(){
if(activeIndex===null) return
packs.splice(activeIndex,1)
saveToGitHub()
}
</script>
</body>
</html>
